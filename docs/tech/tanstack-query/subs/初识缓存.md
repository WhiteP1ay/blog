## 初识缓存

### 过期时间

想象一个场景： 你可能开着浏览器会话一整天。此时页面数据和服务端数据一致的可能性已经非常低了。

query基于staleTime定义过期时间（毫秒单位）。

如果没超时，将不会发请求，而是直接返回缓存数据。

例如

```ts
{ staleTime: 60000 }
```

意味着一分钟内，不会再发网络请求，而是直接从缓存里取值返回。

该值默认为0，缓存保质期是多久应该由开发人员和业务场景决定。如果缓存过期了，query并不会自动重新获取数据。

### 更新缓存

如果缓存过期了，只有以下四种情况会更新缓存数据。

1. querykey变更
2. 订阅过期状态的组件渲染到页面（比如一个引用了过期缓存的弹窗，该弹窗的弹出会导致更新缓存）
3. 浏览器窗口重新获取焦点
4. 设备网络成功重连

其中三种情况可以手动关闭

```ts
useQuery({
  queryKey: ['todo', sort],
  queryFn: ()=> fetchTodo(sort),
  refetchOnMount: false,
  refetchOnWindowFocus: false,
  refetchOnReconnect: false,
  // 也可以设置无穷大 Infinity
  staleTime: 30*1000
})
```

## 示例

获取数据，数据保质期5s，过期了展示更新按钮给用户，点击重新获取新数据。

